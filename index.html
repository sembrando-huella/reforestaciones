<!DOCTYPE html>
<html>
<head>
	
    <title>Sembrando Huella</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src='https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js'></script>

     <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
   integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
   crossorigin=""></script>
    
	<!-- <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/"></script> -->

   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	
	<script src="https://stamen-maps.a.ssl.fastly.net/js/tile.stamen.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://rawgit.com/python-visualization/folium/master/folium/templates/leaflet.awesome.rotate.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
	

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"/>
	
</head>
<body>
<script src="guate.geojson"></script>
<script src="subreg.geojson"></script>
<script src="reg.geojson"></script>
<style>


h2{
	text-align:center;
}

dl {
    border: 2px double #ccc;
    padding: 0.5em;
  }
  dt {
	
    float: left;
    clear: left;
	
    width: 170px;
   
    font-weight: bold;
    color: green;
  }
  dt::after {
    content: ":";
  }
 
  dd {
    margin: 0 0 0 170px;
    padding: 0 0 0.5em 0;
  }

</style>

<div id="map" style="width: 100vw; height: 100vh;"></div>
<script>



	$.getJSON('https://api.sheety.co/e63bfa0b-68d2-4a7d-9a07-9d084fe59eab', function(json) {
		addPoints(json);
	});
	
	var subregStyle = { //estilo para las lineas de subregiones
		"color": "#ff7800",	
		"weight": 1,
		"opacity": 0.3,
		"fillColor": "#ffffff",
		"fillOpacity": 0
		
	}
	var regStyle = { //estilo para las lineas de regiones
		"color": "#ff7800",	
		"weight": 3,
		"opacity": 0.7,
		"fillColor": "#ffffff",
		"fillOpacity": 0
		
	}
	
	var map = L.map('map').setView([15.316175, -90.402719], 4);
	var guateLayer = L.geoJSON();
	guateLayer.addData(guate);
	//guateLayer.addTo(map);

	
	var subreglyr = L.geoJSON();
	subreglyr.addData(subreg);
	subreglyr.addTo(map);
	subreglyr.setStyle(subregStyle);
	
	var reglyr = L.geoJSON();
	reglyr.addData(reg);
	reglyr.addTo(map);
	reglyr.setStyle(regStyle);
	
	var Thunderforest_Pioneer = L.tileLayer('https://tile.thunderforest.com/pioneer/{z}/{x}/{y}.png?apikey=45d2630d5e6c400caad9897e25633ccd', {
	attribution: '&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors. Icon made by <a href="https://www.freepik.com">Freepik</a> from <a href="https://www.flaticon.com">www.flaticon.com</a>',
	apikey: '<45d2630d5e6c400caad9897e25633ccd>',
	maxZoom: 22
	});
	 map.addLayer(Thunderforest_Pioneer);
	
	
	var pointGroupLayer;
	
	function addPoints(data) {
	if (pointGroupLayer != null) {
		pointGroupLayer.remove();
	}
	
	pointGroupLayer = L.featureGroup().addTo(map);
	
	for(var row = 0; row < data.length; row++) {
		if (data[row].y > 13.8 && data[row].jornada === 1){
			// bloque para crear un array con las instituciones colaboradoras sin que se repitan los nombres
			var inst1 = new Array();
			var inst2 = new Array();
			if (data[row].coordinadora != null ){inst1 = data[row].coordinadora.split(/,|;/)};
			if (data[row].colaboradores != null ){inst2 = data[row].colaboradores.split(/,|;/)};
			
			for(var i = 0; i < inst1.length; i++){ //ciclo para eliminar las palabras repetidas
				inst2 = inst2.filter(function(palabra) {
				return palabra != inst1[i];
				});		
			}
			
		
			var instituciones =(inst1.concat(inst2).length == 0) ? "" :("</dd><dt>Instituciones colaboradoras </dt><dd>" + inst1.concat(inst2).join('; ')); //añade punto y coma como separador entre elementos del array
			//FIN DE BLOQUE PARA CREAR ARRAY DE INSTITUCIONES COLABORADORAS
			
			var arboles = (
			data[row].plantas === null ? "" :
			data[row].plantas === 0 ? "" : ("</dd><dt>Árboles reforestados </dt><dd>"+ data[row].plantas)); //muestra la linea de arboles sembrados solo cuando existe el dato
			
			var marker = L.marker([data[row].y, data[row].x]).addTo(pointGroupLayer);
			marker.bindPopup("<dl>" + "<h2>Información</h2><dt>Subregión </dt><dd>" + data[row].subreg + "</dd><dt>Fecha </dt><dd>"+ data[row].fecha + arboles + "</dd><h2>Amigos del Bosque</h2><dt>Total de participantes </dt><dd>"+ data[row].total + instituciones + "</dd></dl>",
			{
			maxWidth: 380,
			maxHeight: 700
			
			});
			// icon
			var icon = L.icon({
				iconUrl: 'icon.png',
				iconSize:     [16, 20], // size of the icon
				iconAnchor:   [8, 20],
				popupAnchor: [0, -18],
			});
			marker.setIcon(icon);
			
			}
			
		}
		map.fitBounds(guateLayer.getBounds());
		
	
	
	
}


			
</script>



</body>
</html>
